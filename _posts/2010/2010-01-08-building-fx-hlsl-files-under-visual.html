---
layout: post
title: Building .fx hlsl files with a Custom Build Rule under Visual Studio 2008
date: '2010-01-08T20:26:00.009+11:00'
tags:
- Tools
- shader
- hlsl
- Visual Studio
- nshader
modified_time: '2010-01-08T21:29:32.959+11:00'
thumbnail: http://3.bp.blogspot.com/_dv_YkYWn3HA/S0b2eDHq2kI/AAAAAAAACuQ/-IPQ0nbqUUI/s72-c/fxrules_vs1.png
comments: true
blogger_id: tag:blogger.com,1999:blog-1076643699683521890.post-5391944427621331350
blogger_orig_url: http://code4k.blogspot.com/2010/01/building-fx-hlsl-files-under-visual.html
---

It's sometimes convenient to be able to compile directly a .fx file under a VS C++ project. <a href="http://nshader.codeplex.com/">NShader </a>provides a nice way to highlight your code, but it's not able (yet, not sure I will update it up to this feature) to compile anything or to display syntax errors.<br /><br />Hopefully, there is a simple workaround, avoiding to develop your own custom building task : using a <b>custom build rule</b>. Unfortunately, I was able to find one a while ago on Internet, but I lost it, and if I remember, it was lacking some features (like showing all available profiles)... So I decided yesterday to implement my own building rules files, leveraging on the existing .asm rules files that is shipped with Visual Studio, and It was surprisingly easy to write it.<br /><br />To add this custom building rules to VS, follow these instructions:<br /><br /><a name='more'></a><br /><ol><li>Download the<a href="http://rmasm.net/code4k/fxrules/fx.rules"> fx.rules custom build rules files</a>.</li><li>Put the fx.rules files under in the following path (according to the installation path of your VS) : <code>C:\Program Files\Microsoft Visual Studio 9.0\VC\VCProjectDefaults</code></li><li>Allow the use of the fx custom build rules under your project. For this, go to the solution explorer, right click on your project and select the menu "Custom Build Rules..." <br /><a href="http://3.bp.blogspot.com/_dv_YkYWn3HA/S0b2eDHq2kI/AAAAAAAACuQ/-IPQ0nbqUUI/s1600-h/fxrules_vs1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/_dv_YkYWn3HA/S0b2eDHq2kI/AAAAAAAACuQ/-IPQ0nbqUUI/s320/fxrules_vs1.png" /></a><br /></li><li>Then enable the fx rules in the "Visual C++ Custom Build Rules" window : <br /><a href="http://2.bp.blogspot.com/_dv_YkYWn3HA/S0b3HopLD7I/AAAAAAAACuY/x_3fy6pZiWg/s1600-h/fxrules_vs2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/_dv_YkYWn3HA/S0b3HopLD7I/AAAAAAAACuY/x_3fy6pZiWg/s320/fxrules_vs2.png" /></a><br /></li><li>Then you need to have the fxc.exe compiler in the Visual C++ path. You could add it to your system path although i prefer to add it inside VS itself. For this, go to the <code>Tools/Options</code> menu. Then go to the subtree : "Projects and Solutions/VC++ Directories". On the right pane, in "Show Directories for: " select&nbsp; "Executable files", and add below the path to the directory containing the fxc.exe tool.</li><li>The nice thing is that you can customize the compilation per file. Just click on the property of your ".fx" file and you will see all the fxc options :<br /><a href="http://4.bp.blogspot.com/_dv_YkYWn3HA/S0b4o-QctMI/AAAAAAAACug/5jSR6TAiizw/s1600-h/fxrules_vs3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/_dv_YkYWn3HA/S0b4o-QctMI/AAAAAAAACug/5jSR6TAiizw/s320/fxrules_vs3.png" /></a> </li><li>And you are done!</li><li>The only drawback is that it's only working with a VC++ project, so it makes it harder to use it for a C# XNA Project, but you can create an almost empty VC++ project, add it to your solution, this c++ project would only contains links to your fx files in your C# Project (assuming that you have VS 2008 C++ and C# integrated together).<br /></li></ol>I will also publish this month an update of NShader to address some issues. If I had more time for this kind of thing, It would be great to add a real Shader IDE inside VS 2008 (in the way the still-long awaited NVidia's nexus beta.is done). Actually, It's not so hard to do such thing... but it would take a huge time, and I have to seriously code some demo instead of working on satellite projects and... before I'm getting too old for that! ;)<br /><ol>&nbsp;</ol><ol>&nbsp;</ol><ol></ol>