<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="lunet 0.4.1.0">
    <title>AsmHighlighter Part II : Automatic x86 asm instruction size evaluation | xoofx</title>
    <link rel="stylesheet" href="/css/site.css">
    <script src="/js/site-defer.js" defer></script>
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@xoofx">
    <meta name="twitter:title" content="AsmHighlighter Part II : Automatic x86 asm instruction size evaluation | xoofx">
    <meta name="twitter:description" content="Following the previous post about AsmHighlighter, I have just released a new version 1.1 of AsmHighlighter that evaluates x86 ASM instruction size for each instructions in your code. The instruction size is inserted in the comment next to the instruction.When you are coding 4k or 64k (partially) demos in x86 assembler with size optimization in mind, it's sometimes useful to check the instruction size (as it is sometimes not so...">
    <meta name="twitter:image" content="https://xoofx.com/images/twitter-banner.png">
    <meta name="twitter:image:alt" content="AsmHighlighter Part II : Automatic x86 asm instruction size evaluation | xoofx">    

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0DVR9ML8KY"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-0DVR9ML8KY');</script>  
  </head>
  <body>
  <div class="container">
    <div class="row">
      <nav class="navbar navbar-expand-md navbar-light w-100">
            <a class="xoofx-logo navbar-brand" href="/"></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
            </button>
            <div id="navbarSupportedContent" class="collapse navbar-collapse justify-content-between">
<ol id='nav-id-home-0' class='navbar-nav nav-level0  w-100'>
  <li class='nav-item '>
    <span class='nav-item-row'><a href='/' class='nav-link  '>Home</a></span>  </li>
  <li class='nav-item  active'>
    <span class='nav-item-row'><a href='/blog/' class='nav-link  '>Blog</a></span>  </li>
  <li class='nav-item '>
    <span class='nav-item-row'><a href='/projects/' class='nav-link  '>Projects</a></span>  </li>
  <li class='nav-item  ml-auto'>
    <span class='nav-item-row'><a href='/about/' class='nav-link  '>About</a></span>  </li>
</ol>
            </div>            
      </nav>
    </div>
    <div class="row">
      
<div class="col-sm-9 js-toc-content">
  <p id="lunet-results"></p>
  <article class="page">
    <div class="title">
		  <h1 class="title"><a href="/blog/2009/10/19/asmhighlighter-part-ii-automatic-x86/">AsmHighlighter Part II : Automatic x86 asm instruction size evaluation</a></h1>
		
    </div>
    <div class="entry-content">
    <div class="blog-post-meta">
      <span class="fa fa-calendar"></span>
      <span class="date"><time datetime="2009-10-19" itemprop="datePublished">October 19, 2009</time></span>
      <i class="fa fa-tags"></i><a href="/blog/tag/assembler/">assembler</a>, <a href="/blog/tag/tools/">Tools</a>, <a href="/blog/tag/x86/">x86</a>, <a href="/blog/tag/visual-studio/">Visual Studio</a>
  	  <span class="fa fa-edit"></span> <a href="https://github.com/xoofx/xoofx.github.io/edit/master/blog/2009/2009-10-20-asmhighlighter-part-ii-automatic-x86.html">edit</a>
    </div>
      

Following the <a href="/blog/2009/10/19/adding-asm-x86-syntax-highlighting-to#links">previous post about AsmHighlighter</a>, I have just released a new version 1.1 of <a href="http://asmhighlighter.codeplex.com/">AsmHighlighter </a>that<b> evaluates x86 ASM instruction size for each instructions</b> in your code. The instruction size is inserted in the comment next to the instruction.<br /><br />When you are coding 4k or 64k (partially) demos in x86 assembler with size optimization in mind, it's sometimes useful to check the instruction size (as it is sometimes not so obvious, x86 has a lot of weird rules for their instruction size, particularly when using eax register on source/destination, or using ebx without an offset...etc).<br /><br />This feature is available when you perform a formating of your document (Menu Edit/Advanced/Format document or selection, or Ctrl+k, Ctrl+d). Here is a screenshot result: <br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/_dv_YkYWn3HA/Stzljj0CYDI/AAAAAAAACg4/JH5Ac3IMEvo/s1600-h/FormatCodeWithInstructionSize.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/_dv_YkYWn3HA/Stzljj0CYDI/AAAAAAAACg4/JH5Ac3IMEvo/s640/FormatCodeWithInstructionSize.png" /></a><br /></div><br />The magic behind it is that i have discovered a cool managed library called : <a href="http://www.edgeofnowhere.cc/viewtopic.php?t=429220">Fasm Managed from Shynd's</a>. This is a managed .NET dll that can perform dynamic x86 ASM compilation inside a .NET application. The code is simple as below:<br /><br /><code>byte[] buffer = ManagedFasm.Assemble("mov eax, 0");</code><br /><br />Thanks to this great module, it was quite easy to integrate a fast evaluation of a x86 instruction size, although this evaluation is done at the line level, so the evaluation doesn't have any information on labels, defines...etc. But i have integrated a simple (but not perfect) workaround. Also, because this library is using FASM as a compiler, i had to perform some "normalization" on the code (that is mainly targeting MASM syntax), but it's working quite well!<br /><br /><br />With this instruction size feature, AsmHighlighter is becoming a bit more related to 4k-64k intros coding! ;)
    </div>
  </article>
</div>
<div class="col-sm-3">
  <nav class="js-toc toc sticky-top"></nav>
</div>
    </div>
  </div>
	<footer class="blog-footer">
        <p>Copyright &copy; 2009 - 2020, Alexandre Mutel - Blog content licensed under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/">CC BY 2.5</a> | Site powered by <a href="https://github.com/lunet-io/lunet">lunet</a></p>
	</footer>  
  </body>
</html>

